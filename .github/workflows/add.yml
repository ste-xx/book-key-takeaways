name: Add a book to a topic

on:
  workflow_dispatch:
    inputs:
      title:
        type: string
        description: "title for the new book"
        required: true
      image_url:
        type: string
        description: "image url"
        required: true
      topic:
        type: string
        description: "given topic"
        required: true

jobs:
  scaffold_entry:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2

      - run: echo ::set-output name=lowerCase::$(cat README.md | tr '[:upper:]' '[:lower:]')
        id: readme
      - run: echo ::set-output name=lowerCaseWithMdHeader::$(echo "### ${{ github.event.inputs.topic }}" | tr '[:upper:]' '[:lower:]')
        id: topic
      - run: echo "${{ steps.readme.outputs.lowerCase }}"
      - run: echo "${{ steps.topic.outputs.lowerCaseWithMdHeader }}"

      - if: ${{ !contains(steps.readme.outputs.lowerCase, steps.topic.outputs.lowerCaseWithMdHeader) }}
        run: |-
          cat >> README.md <<EOF
          
          ### ${{ github.event.inputs.topic }}
          | Cover         | Title         | Link  |
          | ------------- |:-------------:| -----:|
          EOF

      - run: |
          git config --global user.name 'Stefan Breitenstein'
          git config --global user.email 'ste-xx@users.noreply.github.com'
          git commit -am "Add entry: ${{ github.event.inputs.title }} in ${{ github.event.inputs.topic }}"
          git push
#      - run: "if header not exists: add header, add table (| Cover         | Title         | Link  |)"
#      - run: "transform title to lowercase_snakecase "
#      - run: "add entry to header/table (transformed_title/cover.jpg | title | transformed_title/takeaways.md)"
#      - run: "wget image_url -> transformed_title/cover.jpg"
#      - run: "create transformed_title/takeaways.md"